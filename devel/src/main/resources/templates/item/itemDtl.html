<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/layout1}">

<head>
    <!--<meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<!-- ì‚¬ìš©ì ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function(){
            var price = $("#price").val();
            $("#priceDisplay").html(price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 'ì›');
            calculateTotalPrice();

            // ë©”ì¸ ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ
            $("#count, #floatingCountInput").on("change input", function(){
                validateStock($(this));  // ì¬ê³  ê²€ì‚¬
                calculateTotalPrice();   // ê²°ì œ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            });

            // í° ì´ë¯¸ì§€ ì´ˆê¸° ì„¤ì •
            $("#largeImage").attr("src", $(".thumbnail-img").first().attr("src"));
            $(".thumbnail-img").first().addClass("selected-thumbnail");

            // ì¡°ê·¸ë§Œ ì´ë¯¸ì§€ í´ë¦­ ì‹œ í° ì´ë¯¸ì§€ë¡œ ë³€ê²½
            $(".thumbnail-img").click(function() {
                var src = $(this).attr("src");
                $("#largeImage").addClass("fade-out");
                setTimeout(function() {
                    $("#largeImage").attr("src", src).removeClass("fade-out");
                }, 250);
                $(".thumbnail-img").removeClass("selected-thumbnail");
                $(this).addClass("selected-thumbnail");
            });
        });

        function calculateTotalPrice(){
            var count = $("#count").val();
            var price = $("#price").val();
            var totalPrice = price * count;
            var formattedTotalPrice = totalPrice.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + 'ì›';

            // ì›ë˜ totalPriceë¥¼ í‘œì‹œí•˜ëŠ” ì˜ì—­ ì—…ë°ì´íŠ¸
            $("#totalPrice").html(formattedTotalPrice); // ê¸°ì¡´ ê²°ì œ ê¸ˆì•¡ í‘œì‹œ ì˜ì—­

            // ìŠ¤í¬ë¡¤ì— í‘œì‹œë˜ëŠ” ê²°ì œ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            $("#floatingTotalPrice").html(formattedTotalPrice);

            // ìˆ˜ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸
            $("#floatingCountDisplay").html($("#stockDisplay").text());
            $("#floatingCountInput").val(count);
        }

        // ì¬ê³  ì´ˆê³¼ ê²€ì‚¬ í•¨ìˆ˜
        function validateStock(inputField) {
            var stock = parseInt($("#stockDisplay").text(), 10); // ì¬ê³  ìˆ˜ëŸ‰
            var count = parseInt(inputField.val(), 10); // ì…ë ¥ëœ ìˆ˜ëŸ‰

            if (count > stock) {
                alert("ì¬ê³  ìˆ˜ëŸ‰ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ë‚¨ì€ ì¬ê³ : " + stock + "ê°œ");
                count = stock; // ì¬ê³  ìˆ˜ëŸ‰ìœ¼ë¡œ ì„¤ì •
                inputField.val(count); // ì…ë ¥ í•„ë“œì— ì—…ë°ì´íŠ¸
            }

            // ìˆ˜ëŸ‰ì„ ë‹¤ë¥¸ ì…ë ¥ í•„ë“œì—ë„ ë™ê¸°í™”í•˜ê³ , ê²°ì œ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            $("#count").val(count);
            $("#floatingCountInput").val(count);
        }

        function order(){
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            var url = "/order";
            var paramData = {
                itemId: $("#itemId").val(),
                count: $("#count").val()
            };

            var param = JSON.stringify(paramData);

            $.ajax({
                url: url,
                type: "POST",
                contentType: "application/json",
                data: param,
                beforeSend: function(xhr){
                    xhr.setRequestHeader(header, token);
                },
                dataType: "json",
                cache: false,
                success: function(result, status){
                    var orderId = result;
                    // íŒì—… ì°½ í¬ê¸° ì„¤ì •
                    var width = 1000;
                    var height = 700;

                    // ë¸Œë¼ìš°ì € ì°½ì˜ ì¤‘ì•™ì— ìœ„ì¹˜ ê³„ì‚°
                    var left = window.screenX + (window.innerWidth - width) / 2;
                    var top = window.screenY + (window.innerHeight - height) / 2;

                    // ìƒˆ ì°½ìœ¼ë¡œ ê²°ì œ í˜ì´ì§€ ì—´ê¸° (ì¤‘ì•™ ìœ„ì¹˜ ì„¤ì •)
                    var paymentWindow = window.open(
                        '/payments/paymentP?orderId=' + orderId,
                        'paymentPopup',
                        `width=${width},height=${height},left=${left},top=${top},scrollbars=yes,resizable=yes`
                    );
                },
                error: function(jqXHR, status, error){
                    if (jqXHR.status === 400) {
                        alert(jqXHR.responseText); // ì„œë²„ì—ì„œ ë°›ì€ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
                    } else {
                        alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”');
                        location.href = '/members/login';
                    }
                }
            });
        }

        function addCart(){
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            var url = "/cart";
            var paramData = {
                itemId: $("#itemId").val(),
                count: $("#count").val()
            };

            var param = JSON.stringify(paramData);

            $.ajax({
                url: url,
                type: "POST",
                contentType: "application/json",
                data: param,
                beforeSend: function(xhr){
                    xhr.setRequestHeader(header, token);
                },
                dataType: "json",
                cache: false,
                success: function(result, status){
                    alert("ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤.");
                    location.href = '/cart';
                },
                error: function(jqXHR, status, error){
                    alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”');
                    location.href = '/members/login';
                }
            });
        }
        function scrollToHeader() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function scrollToFooter() {
            document.querySelector('.footer').scrollIntoView({ behavior: 'smooth' });
        }
        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ì—ì„œ ë³´ì—¬ì§€ëŠ” ìˆ˜ëŸ‰ê³¼ ê²°ì œ ê¸ˆì•¡ ë™ê¸°í™”
        $(document).ready(function() {
            $(window).scroll(function() {
                var scrollPosition = $(window).scrollTop();
                var triggerPosition = 600;

                if (scrollPosition > triggerPosition) {
                    $('#floatingPurchaseContainer').addClass('visible');
                    calculateTotalPrice();  // ìŠ¤í¬ë¡¤ ì‹œ ê²°ì œ ê¸ˆì•¡ê³¼ ìˆ˜ëŸ‰ ë™ê¸°í™”
                } else {
                    $('#floatingPurchaseContainer').removeClass('visible');
                }
            });

            // floatingCountInput ë³€ê²½ ì‹œ ê¸°ì¡´ ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œì— ë™ê¸°í™”
            $("#floatingCountInput").on("input", function() {
                var floatingCount = $(this).val();
                $("#count").val(floatingCount);
                calculateTotalPrice();  // ìˆ˜ëŸ‰ ë³€ê²½ì— ë”°ë¼ ê²°ì œ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
            });
        });
    </script>
</th:block>

<!-- ì‚¬ìš©ì CSS ì¶”ê°€ -->
<th:block layout:fragment="css">
    <style>
        .mgb-15 {
            margin-bottom: 15px;
        }
        .mgt-30 {
            margin-top: 30px;
        }
        .mgt-120 {
            margin-top: 120px;
        }

        .repImg {
            width: 100%;
            height: 400px;
            object-fit: contain;
            object-position: center;
            border:1px solid lightgray;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        .repImg.fade-out {
            opacity: 0;
        }
        .carousel-img {
            width: 104px;
            height: 130px;
            cursor: pointer;
            object-fit: contain;
            object-position: center;
            margin-top:15px;
            border:1px solid lightgray;
            padding:3px;
            border-radius:10px;
            transition: transform 0.3s ease;
        }
        .carousel-img.selected-thumbnail {
            transform: scale(1.15);
        }
        .flex-container {
            display: flex;
            align-items: stretch;
            justify-content: space-between;
            gap: 20px;
        }
        .flex-item {
            width:50%;
            margin-right:100px;
        }
        .flex-item:last-child {
            margin-right: 0;
        }
        .thumbnail-container {
            display: flex;
            gap: 10px;
        }
        .wishlist-btn {
            background: none;
            border: none;
            cursor: pointer;
            margin: 0; /* ë²„íŠ¼ì˜ ì—¬ë°± ì œê±° */
            padding: 0; /* íŒ¨ë”© ì œê±°í•˜ì—¬ í¬ê¸° ìµœì†Œí™” */
        }

        .wishlist-btn .fa-heart {
            font-size: 24px;
            color: grey;
        }

        .wishlist-btn .fa-heart.red {
            color: red;
        }

        .wishlist-btn:focus {
            outline: none;
            box-shadow: none;
        }
        .scroll-button-container {
            position: fixed;
            top: 50%;
            right: 50px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .scroll-button {
            background-color: #5D9BD6;
            color: white;
            border: none;
            width: 57px;
            height: 57px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            outline: none;
        }

        .scroll-button:hover {
            background-color: #0056b3;
        }

        .scroll-button:focus {
            outline: none;
        }

        .scroll-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            line-height: 1.2;
        }
        .scroll-button-container  top: 52%;
        .wishlist-container img {
            transition: filter 0.3s ease;
        }

        .wishlist-container img:hover {
            filter: grayscale(100%);
        }
        .wishlist-container li{
            transition:transform 0.3s ease;
        }
        .wishlist-container li:hover{
            transform: translateY(-5px);
        }
        .link-hover h6 {
            transition: color 0.3s ease, transform 0.3s ease;
            text-align: center;
            display: block;
            color: gray;
        }

        .link-hover:hover h6 {
            color: black;
            transform: translateY(-5px);
        }

        .link-hover {
            text-decoration: none !important; /* ë§í¬ì— ê°•ì œ ë°‘ì¤„ ì œê±° */
        }

        .link-hover:hover {
            text-decoration: none !important; /* ë§í¬ì— ê°•ì œ ë°‘ì¤„ ì œê±° */
        }
        .floating-container {
            position: fixed;
            width:370px;
            left: -370px;
            bottom: 40%;
            transition: left 0.5s ease-in-out;
            z-index: 10000;
            border: 1px solid silver;
            padding:20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            border-radius:10px;
        }

        .floating-container.visible {
            left: 20px; /* ë³´ì´ëŠ” ìœ„ì¹˜ ì¡°ì • */
        }

        .floating-purchase
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</th:block>

<div layout:fragment="content" style="margin-left: 25%; margin-right: 25%;">
    <!-- ì¶”ê°€ëœ ê²°ì œ/êµ¬ë§¤ ì»¨í…Œì´ë„ˆ -->
    <div th:if="${item.itemSellStatus == T(com.treasuredigger.devel.constant.ItemSellStatus).SELL}" id="floatingPurchaseContainer" class="floating-container">
        <div class="floating-purchase">
            <div th:if="${item.stockNumber > 0}" class="text-right">
                <h5>ê²°ì œ ê¸ˆì•¡</h5>
                <h3 id="floatingTotalPrice" class="font-weight-bold"></h3>
                <!-- ìˆ˜ëŸ‰ í‘œì‹œì™€ ìˆ˜ëŸ‰ ì…ë ¥ í•„ë“œ ì¶”ê°€ -->
                <div class="input-group" style="margin-top: 15px; margin-left: auto; width:200px">
                    <div class="input-group-prepend">
                        <span class="input-group-text">ìˆ˜ëŸ‰</span>
                    </div>
                    <input type="number" id="floatingCountInput" class="form-control text-left" style="margin-left: auto;" min="1" value="1">
                </div>
                <div class="mb-3">
                    ë‚¨ì€ ì¬ê³  : <span id="floatingCountDisplay"></span>ê°œ<br>
                </div>
                <button type="button" class="btn btn-light border border-primary btn-lg" onclick="addCart()">
                    <img src="/images/cartAdd.png" style="width:30px"> ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°
                </button>
                <button type="button" class="btn btn-primary btn-lg" onclick="order()">êµ¬ë§¤</button>
            </div>
        </div>
    </div>
    <input type="hidden" id="itemId" th:value="${item.id}">
    <div style="width: 80%; margin: 0 auto;">
        <div class="h6" th:text="'ğŸŒŸì¼ë°˜ìƒí’ˆ >  ' + ${item.cname} +' > ' +  ${item.id}"></div>
        <div class="flex-container mb-4">
            <div class="flex-item">
                <!-- í° ì´ë¯¸ì§€ -->
                <div class="img" style="position: relative; width: 100%; margin: 0 auto;">
                    <img id="largeImage"
                         th:src="${item.itemImgDtoList[0].imgUrl}"
                         class="rounded repImg"
                         th:alt="${item.itemNm}"
                         data-zoom="3"
                         alt="í° ì´ë¯¸ì§€"
                         style="display: block; width: 100%;">

                    <!-- í™•ëŒ€ìš© ë§ˆê·¸ë‹ˆíŒŒì´ì–´ -->
                    <span class="magnifier"
                          style="display: none; position: absolute; width: 200px; height: 200px; border-radius: 50%; z-index: 1; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);">
                    </span>
                </div>

                <!-- ì¸ë„¤ì¼ ì´ë¯¸ì§€ë“¤ -->
                <div class="thumbnail-container mb-4">
                    <!-- ì¡°ê·¸ë§Œ ì´ë¯¸ì§€ë“¤ -->
                    <img th:each="itemImg : ${item.itemImgDtoList}"
                         th:if="${not #strings.isEmpty(itemImg.imgUrl)}"
                         th:src="${itemImg.imgUrl}"
                         class="thumbnail-img carousel-img"
                         alt="ì¸ë„¤ì¼ ì´ë¯¸ì§€"
                         style="width: 100px; height: 100px; object-fit: cover; margin-right: 10px;">
                </div>

                <span style="color:gray">â€» ì´ë¯¸ì§€ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ì‹œë©´ í™•ëŒ€í•˜ì—¬ ë³´ì‹¤ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
            </div>

            <!-- ìƒí’ˆ ì •ë³´ -->
            <div class="flex-item" style="position: relative;">
                <div class="d-flex justify-content-between">
                    <span th:if="${item.itemSellStatus == T(com.treasuredigger.devel.constant.ItemSellStatus).SELL}" class="badge badge-primary mgb-15">
                        íŒë§¤ì¤‘
                    </span>
                    <span th:unless="${item.itemSellStatus == T(com.treasuredigger.devel.constant.ItemSellStatus).SELL}" class="badge btn-danger mgb-15">
                        í’ˆì ˆ
                    </span>
                    <div></div> <!-- ë¹ˆ divë¡œ ì²« ë²ˆì§¸ ì¤„ì„ ë¹„ìš°ê¸° ìœ„í•´ ì¶”ê°€ -->
                    <button id="wishlistButton" data-biditemid="${biditem.bidItemId}" class="wishlist-btn" sec:authorize="isAuthenticated()">
                        <i id="heartIcon" class="far fa-heart"></i> <!-- ê¸°ë³¸ì€ ë¹ˆ í•˜íŠ¸ -->
                    </button>
                </div>
                <script>
                    $(document).ready(function() {
                         var csrfToken = $('meta[name="_csrf"]').attr('content');
                         var csrfHeader = $('meta[name="_csrf_header"]').attr('content');
                         var ItemId = $('#itemId').val();
                         var heartIcon = $('#heartIcon');

                         // í˜ì´ì§€ ë¡œë“œ ì‹œ ê´€ì‹¬ìƒí’ˆ ì—¬ë¶€ í™•ì¸
                         $.ajax({
                             url: '/wishlist/check',
                             type: 'GET',
                             data: { entityType: 'Item', entityId: ItemId },
                             beforeSend: function(xhr) {
                                 xhr.setRequestHeader(csrfHeader, csrfToken);
                             },
                             success: function(response) {
                                 if (response) {
                                     heartIcon.addClass('fas red'); // ê´€ì‹¬ìƒí’ˆì¼ ê²½ìš° ì±„ì›Œì§„ ë¹¨ê°„ í•˜íŠ¸
                                 } else {
                                     heartIcon.addClass('fas').addClass('grey'); // ê´€ì‹¬ìƒí’ˆì´ ì•„ë‹ ê²½ìš° ë¹ˆ í•˜íŠ¸
                                 }
                             },
                             error: function(xhr, status, error) {
                                 console.log('Status:', status);
                                 console.log('Error:', error);
                                 console.log('ResponseText:', xhr.responseText);
                                 alert('ê´€ì‹¬ìƒí’ˆ ì—¬ë¶€ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                             }
                         });

                         // ê´€ì‹¬ìƒí’ˆ ë²„íŠ¼ í´ë¦­ ì‹œ í† ê¸€
                         $('#wishlistButton').click(function() {
                             $.ajax({
                                 url: '/wishlist/toggle',
                                 type: 'POST',
                                 contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                                 data: {  entityType: 'Item', entityId: ItemId },
                                 beforeSend: function(xhr) {
                                     xhr.setRequestHeader(csrfHeader, csrfToken);
                                 },
                                 success: function(response) {
                                     if (heartIcon.hasClass('red')) {
                                         heartIcon.removeClass('red');
                                         alert('ê´€ì‹¬ìƒí’ˆì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                                     } else {
                                         heartIcon.addClass('red');
                                         alert('ê´€ì‹¬ìƒí’ˆìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                     }
                                 },
                                 error: function(xhr, status, error) {
                                     console.log('Status:', status);
                                     console.log('Error:', error);
                                     console.log('ResponseText:', xhr.responseText);
                                     alert('ê´€ì‹¬ìƒí’ˆ ê¸°ëŠ¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                 }
                             });
                         });
                     });

                </script>

                <div class="h4" th:text="${item.itemNm}"></div>
                <hr class="my-4">

                <div class="text-right">
                    <div class="h4 text-danger text-left">
                        <input type="hidden" th:value="${item.price}" id="price" name="price">
                        <span id="priceDisplay"></span>
                    </div>
                    <div th:if="${item.stockNumber > 0}" class="input-group w-50">
                        <div class="input-group-prepend">
                            <span class="input-group-text">ìˆ˜ëŸ‰</span>
                        </div>
                        <input type="number" name="count" id="count" class="form-control" value="1" min="1">
                    </div>
                </div>
                <hr class="my-4">
                ë‚¨ì€ ìˆ˜ëŸ‰ : <span id="stockDisplay" th:text="${item.stockNumber}"></span>ê°œ <br>
                <div th:if="${item.stockNumber > 0}" class="text-right mgt-120">
                    <h5>ê²°ì œ ê¸ˆì•¡</h5>
                    <h3 id="totalPrice" class="font-weight-bold"></h3>
                </div>

                <div th:if="${item.itemSellStatus == T(com.treasuredigger.devel.constant.ItemSellStatus).SELL}" class="text-right">
                    <button type="button" class="btn btn-light border border-primary btn-lg" onclick="addCart()"><img src="/images/cartAdd.png" style="width:30px"> ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
                    <button type="button" class="btn btn-primary btn-lg" onclick="order()">êµ¬ë§¤</button>
                </div>
                <div class="text-right" style="margin-top:10px;">
                    <button type="button" class="btn btn-success btn-lg" onclick="history.back();">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
                <div th:unless="${item.itemSellStatus == T(com.treasuredigger.devel.constant.ItemSellStatus).SELL}" class="text-right mt-2">
                    <button type="button" class="btn btn-danger btn-lg">í’ˆì ˆëœ ìƒí’ˆì…ë‹ˆë‹¤</button>
                </div>
            </div>
        </div>
        <div class="scroll-button-container">
            <div class="wishlist-container mb-3" th:if="${#authorization.expression('isAuthenticated()')}">
                <!-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì—ê²Œë§Œ ì½˜í…ì¸  í‘œì‹œ -->
                <a href="/members/wishlist" class="scroll-label link-hover">
                    <h6><i class="fas fa-heart red" style="color:red;"></i> ê´€ì‹¬ìƒí’ˆ</h6>
                </a>
                <ul style="list-style-type: none; padding: 0;">
                    <!-- ê´€ì‹¬ ìƒí’ˆì´ ìˆëŠ” ê²½ìš° ëª©ë¡ì„ ì¶œë ¥ -->
                    <li th:if="${not #lists.isEmpty(recentItemWishlist)}" th:each="wishlistItem : ${recentItemWishlist}" style="margin-bottom: 15px;">
                        <a th:href="'/item/' + ${wishlistItem.itemId}" class="text-dark d-flex flex-column align-items-center" style="text-decoration: none !important;">
                            <img th:src="${wishlistItem.imgUrl}" style="width: 95px; height: 95px; object-fit: contain; object-position: center;margin-bottom: 5px; border:1px solid lightgray; border-radius:10px;">
                            <span th:text="${wishlistItem.itemNm}" style="font-size: 14px; overflow: hidden; text-overflow: ellipsis; text-align: left; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; width: 100px; line-height: 1.3em; max-height: 2.6em;"></span>
                        </a>
                    </li>

                    <!-- ê´€ì‹¬ ìƒí’ˆì´ ì—†ì„ ê²½ìš° í‘œì‹œí•  ë©”ì‹œì§€ -->
                    <li th:if="${#lists.isEmpty(recentItemWishlist)}" class="text-center" style="color: gray; font-size: 14px; margin-top:10px">
                        í˜„ì¬ ê´€ì‹¬ìƒí’ˆì´ <br>ì—†ìŠµë‹ˆë‹¤.
                    </li>
                </ul>
            </div>
            <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œëŠ” ê³µê°„ì„ ë‚¨ê²¨ë‘ê¸° -->
            <div th:if="${!#authorization.expression('isAuthenticated()')}" style="visibility: hidden; height: 450px;"></div>
            <button class="scroll-button" onclick="scrollToHeader()">
                <div class="scroll-label">
                    UP<br>
                    <i class="fas fa-chevron-up"></i>
                </div>
            </button>

            <!-- Scroll Down Button -->
            <button class="scroll-button" onclick="scrollToFooter()">
                <div class="scroll-label">
                    <i class="fas fa-chevron-down"></i>
                    DOWN<br>
                </div>
            </button>
        </div>
        <div>
            <hr class="my-4">
            <div class="itemDesc-container" style="margin: 0 auto 50px auto; width:90%">
                <h4>ìƒí’ˆìƒì„¸ì„¤ëª…</h4>
                <p style="white-space: pre-wrap; margin-top:30px" th:text="${item.itemDetail}"></p>
            </div>
        </div>
        <div th:each="itemImg : ${item.itemImgDtoList}" class="text-center">
            <img th:if="${not #strings.isEmpty(itemImg.imgUrl)}" th:src="${itemImg.imgUrl}" class="rounded" width="90%" style="margin-bottom:50px">
        </div>
    </div>

    <script>
        $(".img").each(function () {
            const zoomFactor = $(this).find('img').data('zoom') || 3; // data-zoom ì†ì„±ì—ì„œ í™•ëŒ€ ë°°ìœ¨ ê°€ì ¸ì˜¤ê¸°
            const imageTarget = $(this).find('img'); // ëŒ€ìƒ ì´ë¯¸ì§€
            const magnifierDiv = $(this).find('.magnifier'); // ë‹ë³´ê¸° ìš”ì†Œ

            // ë‹ë³´ê¸° í¬ê¸°ë¥¼ ëŠ˜ë¦¬ê¸° (ì˜ˆ: widthì™€ heightë¥¼ 150pxë¡œ ì„¤ì •)
            const magnifierSize = 250;  // ë‹ë³´ê¸°ì˜ í¬ê¸°
            magnifierDiv.css({
                "width": `${magnifierSize}px`,
                "height": `${magnifierSize}px`
            });

            // í™•ëŒ€ íš¨ê³¼ í•¨ìˆ˜ ì •ì˜
            function magnify(e) {
                const mousePosX = e.pageX - $(this).offset().left; // ë§ˆìš°ìŠ¤ X ì¢Œí‘œ
                const mousePosY = e.pageY - $(this).offset().top; // ë§ˆìš°ìŠ¤ Y ì¢Œí‘œ

                // ë§ˆìš°ìŠ¤ê°€ ì´ë¯¸ì§€ ì˜ì—­ ì•ˆì— ìˆëŠ”ì§€ í™•ì¸
                if (mousePosX < $(this).width() && mousePosY < $(this).height() && mousePosX > 0 && mousePosY > 0) {
                    magnifierDiv.fadeIn(100); // ë‹ë³´ê¸° í‘œì‹œ
                } else {
                    magnifierDiv.fadeOut(100); // ë‹ë³´ê¸° ìˆ¨ê¸°ê¸°
                    magnifierDiv.css("background-image", "none"); // ë°°ê²½ ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸°
                    return; // ì´ë¯¸ì§€ ë°”ê¹¥ìœ¼ë¡œ ë‚˜ê°”ì„ ë•ŒëŠ” ë” ì´ìƒ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
                }

                // ë‹ë³´ê¸°ê°€ ë³´ì¼ ë•Œ ìœ„ì¹˜ì™€ ë°°ê²½ì„ ì—…ë°ì´íŠ¸
                if (magnifierDiv.is(":visible")) {
                    const bgPosX = -(mousePosX * zoomFactor - magnifierDiv.width() / 2);
                    const bgPosY = -(mousePosY * zoomFactor - magnifierDiv.height() / 2);
                    const magnifierPosX = mousePosX - magnifierDiv.width() / 2;
                    const magnifierPosY = mousePosY - magnifierDiv.height() / 2;

                    magnifierDiv.css({
                        "left": magnifierPosX,
                        "top": magnifierPosY,
                        "background-image": `url('${imageTarget.attr("src")}')`, // ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì •
                        "background-repeat": "no-repeat",
                        "background-size": `${imageTarget.width() * zoomFactor}px ${imageTarget.height() * zoomFactor}px`, // ë°°ê²½ í¬ê¸° ì„¤ì •
                        "background-position": `${bgPosX}px ${bgPosY}px`
                    });
                }
            }

            // ì´ë¯¸ì§€ì— mousemove ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—°ê²°
            $(this).on('mousemove', magnify);
        });
    </script>

</div>
</html>
