<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <title>문의 상세보기</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link th:href="@{/css/layout1.css}" rel="stylesheet">
</head>
<body>

<div th:replace="~{fragments/header::header}"></div>

<div layout:fragment="content" class="content container mt-4">
  <p><strong>작성자:</strong> <span th:text="${inquiry.member.name}"></span></p>
  <p><strong>작성일:</strong> <span th:text="${#dates.format(inquiry.getCreatedDateAsDate(), 'yyyy-MM-dd HH:mm')}"></span></p>
  <h3 style="font-weight:bold;">제목</h3>
  <h6 th:text="${inquiry.title}"></h6>
  <h3 style="font-weight:bold;">내용</h3>
  <p th:text="${inquiry.content}"></p>

  <div>
    <p><strong>답변상태:</strong> <span th:text="${inquiry.answered ? '답변 완료' : '미답변'}"></span></p>
    <p><strong>답변일:</strong> <span th:text="${inquiry.respondedDate != null ? #dates.format(inquiry.getRespondedDateAsDate(), 'yyyy-MM-dd HH:mm') : '미답변'}"></span></p>

    <div>
      <h6 style="font-weight:bold;">답변 내용</h6>
      <div th:if="${inquiry.answered}">
        <p th:text="${inquiry.responseContent}"></p>
      </div>
      <div th:if="${!inquiry.answered}">
        <p>미답변</p>
      </div>
    </div>
  </div>

  <div sec:authorize="hasRole('ADMIN')">
    <div th:if="${!inquiry.answered}">
      <h3>답변하기</h3>
      <form th:action="@{/inquiries/{id}/respond(id=${inquiry.id})}" method="post">
        <div class="form-group">
          <textarea name="responseContent" class="form-control" required placeholder="답변 내용을 입력하세요."></textarea>
        </div>
        <button type="submit" class="btn btn-success">답변하기</button>
      </form>
    </div>

    <div th:if="${inquiry.answered}">
      <h3>답변 수정</h3>
      <form th:action="@{/inquiries/{id}/respond(id=${inquiry.id})}" method="post">
        <div class="form-group">
          <textarea name="responseContent" class="form-control" required th:text="${inquiry.responseContent}"></textarea>
        </div>
        <button type="submit" class="btn btn-success">답변 수정</button>
      </form>
    </div>

    <span th:if="${#authentication.principal.username == inquiry.member.mid}">
      <a th:href="@{/inquiries/{id}/modify(id=${inquiry.id})}" class="btn btn-warning">수정</a>
    </span>

    <form th:action="@{/inquiries/{id}/delete(id=${inquiry.id})}" method="post" style="display:inline;" onsubmit="return confirm('정말 삭제하시겠습니까?');">
      <button type="submit" class="btn btn-danger" sec:authorize="isAuthenticated()">삭제</button>
    </form>

    <a th:href="@{/inquiries}" class="btn btn-secondary">목록</a>
  </div>

</div>

<div th:replace="~{fragments/footer::footer}"></div>

</body>
</html>
