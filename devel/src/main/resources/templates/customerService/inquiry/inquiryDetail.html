<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>
  <meta charset="UTF-8">
  <title>1:1상담문의</title>

  <th:block layout:fragment="css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link th:href="@{/css/layout1.css}" rel="stylesheet">
  </th:block>

  <th:block layout:fragment="script">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </th:block>
</head>
<body>

<div th:replace="~{fragments/header::header}"></div>

<div layout:fragment="content" class="content container">
  <div>
    <p><strong>작성자</strong> <span th:text="${inquiry.member.name}"></span></p>
    <h6 style="font-weight:bold;">제목</h6>
    <p th:text="${inquiry.title}"></p>
    <h6 style="font-weight:bold;">내용</h6>
    <span th:text="${inquiry.content}"></span><br>
    <span th:text="${#dates.format(inquiry.getCreatedDateAsDate(), 'yyyy-MM-dd HH:mm')}" style="font-size:13px; color:gray;"></span>
  </div>

  <div style="border:3px solid gray; border-radius:10px; padding:10px; margin:20px 0;">
    <h6 style="font-weight:bold;">답변 내용</h6>
    <div th:if="${inquiry.answered}">
      <span th:text="${inquiry.responseContent}"></span>
    </div>
    <p><span th:text="${inquiry.respondedDate != null ? #dates.format(inquiry.getRespondedDateAsDate(), 'yyyy-MM-dd HH:mm') : '미답변' }" style="font-size:13px; color:gray;"></span></p>
  </div>

  <div sec:authorize="hasRole('ADMIN')">
    <div th:if="${!inquiry.answered}">
      <h3>답변하기</h3>
      <form th:action="@{/customer-service/inquiries/{id}/respond(id=${inquiry.id})}" method="post">
        <div class="form-group">
          <textarea name="responseContent" class="form-control" required placeholder="답변 내용을 입력하세요."></textarea>
        </div>
        <button type="submit" class="btn btn-success">답변하기</button>
      </form>
    </div>

    <span sec:authorize="hasRole('ADMIN') or #authentication.principal.username == inquiry.member.mid">
      <form th:action="@{/customer-service/inquiries/{id}/delete(id=${inquiry.id})}" method="post" style="display:inline;" onsubmit="return confirm('정말 삭제하시겠습니까?');">
        <button type="submit" class="btn btn-danger">삭제</button>
      </form>
    </span>
  </div>
  <span th:if="${#authentication.principal.username == inquiry.member.mid && !inquiry.answered}">
    <a th:href="@{/customer-service/inquiries/{id}/modify(id=${inquiry.id})}" class="btn btn-warning">수정</a>
  </span>
  <a th:href="@{/customer-service/inquiries}" class="btn btn-secondary">목록</a>
</div>
<p th:text="${#authentication.principal.username}"></p>
<p th:text="${inquiry.member.mid}"></p>
<div th:replace="~{fragments/footer::footer}"></div>

</body>
</html>
